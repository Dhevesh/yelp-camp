<%include ../partials/header%>
<div class="container pt-4">
	<div class="row">
		<div class="col-3">
			<div class="list-group">
				<li class="list-group-item"><span><i class="fas fa-globe"></i></span></li>
				<li class="list-group-item"><span><i class="fas fa-map-marked-alt"></i></span></li>
				<li class="list-group-item"><span><i class="fas fa-phone"></i></span></li>
				<li class="list-group-item"><span><i class="far fa-clock"></i></span></li>
				
			</div>
		</div>
		<div class="col-6">
			<div class="card">
				<img class="card-img-top" src="<%=campground.image%>">
				<div class="card-header">
					<span class="card-head-text pr-2"><%=campground.name%></span>
					<% if(currentUser && campground.author.id.equals(currentUser._id) || currentUser && currentUser.userRole == "admin"){ %>
						<a href="/campgrounds/<%=campground._id%>/edit"><span><i class="far fa-edit"></i></span></a>
						<form class="delete-form" action="/campgrounds/<%=campground._id%>/delete?_method=DELETE" method="POST">
							<button><span><i class="far fa-trash-alt"></i></span></button>
						</form>
					<% } %>
					<div class="float-right"><h6>$<%=campground.price%>/night</h6></div>
					<div>
						<span class="time">Submitted by : <a href="/user/<%=campground.author.id%>"><%=campground.author.name%></a></span><span class="time"> - <%=moment(campground.dateAdded).fromNow()%></span>
					</div>
					<div>
						<form method="POST">
							<button id="likeButton" type="submit" formaction="/campgrounds/<%=campground._id%>/like">
								<span id="likeSpan" class="badge badge-pill badge-secondary"><span class="px-2"><%=campground.likes.length%></span><i class="fas fa-thumbs-up p-1"></i></span>
							</button>
							<button id="dislikeButton" type="submit" formaction="/campgrounds/<%=campground._id%>/dislike">
								<span id="dislikeSpan" class="badge badge-pill badge-secondary"><i class="fas fa-thumbs-down p-1"></i><span class="px-2"><%=campground.dislikes.length%></span></span>
							</button>
						</form>
					</div>
						
				</div>
				<div class="card-body">
					<p class="card-text"><%=campground.description%></p>
				</div>
			</div>
			
			<div>
				<div class="text-right">
					<a class="btn btn-sm btn-success" href="/campgrounds/<%=campground._id%>/reviews/new">Write a Review</a>
				</div>
				<hr>
				<% if (!campground.reviews[0]){ %>
					<div>Be the first to review this campsite!</div>
				<% } else { %>
					<%campground.reviews.forEach((comment)=>{%>
						<div class="row">
							<div class="col-5 pb-2"> <!--review author-->
								<div>
									<strong><a href="/user/<%=comment.author.id%>"><%=comment.author.name%></a></strong>
									<span class="pull-right time">
										<%=moment(comment.dateAdded).fromNow()%>
									</span>
								</div>
									<%for (i = 0; i < author.length; i ++){ %>
										<%if (author[i].id == comment.author.id){ %>
											<% var isAdmin; if (author[i].role == "admin") { isAdmin = "badge-success"} else { isAdmin = "badge-secondary"} %>
											<div class="badge badge-pill <%=isAdmin%> pb-1 mb-1">
												<%=author[i].role%>
											</div>
											<div>
												<% if (author[i].profilePicUrl){ %>
													<img class="user-pic" src="<%=author[i].profilePicUrl%>" alt="user.png">
												<% } %>
											</div>
											<div>
												User since: <%=moment(author[i].created).format("MMM YYYY")%>
											</div>
											<div>
												Posts: <%=author[i].posts.length%>
											</div>
											<div>
												Reviews: <%=author[i].reviews.length%>
											</div>
											<div>

											</div>
											
										<%} %>
									<%} %>
								<div>
								<% if (currentUser && comment.author.id.equals(currentUser._id) || currentUser && currentUser.role == "admin"){ %>
									<a href="/campgrounds/<%=campground._id%>/reviews/<%=comment._id%>/edit"><span><i class="far fa-edit"></i></span></a>
									<form class="delete-form" action="/campgrounds/<%=campground._id%>/reviews/<%=comment._id%>?_method=DELETE" method="POST">
										<button><span><i class="far fa-trash-alt"></i></span></button>
									</form>
								<% }; %>
								</div>
							</div>
							<div class="col-7 pb-2"> <!--review body-->
								<p>
									<%=comment.text%>
								</p>
							</div>
						</div>
					<%})%>
				<%} %>
			</div> <!--reviews div end-->
		</div>
	</div>
</div>
<%include ../partials/footer%>